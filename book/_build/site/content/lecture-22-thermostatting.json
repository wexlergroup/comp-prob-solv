{"version":2,"kind":"Notebook","sha256":"69c3a6bbd6218219ac0554c4054e6cd0df0a32b618ef5de5d18744f8bebfd541","slug":"lecture-22-thermostatting","location":"/lecture-22-thermostatting.md","dependencies":[],"frontmatter":{"title":"Chapter 21: Thermostatting","kernelspec":{"name":"python3","display_name":"comp-prob-solv","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.4"}},"content_includes_title":false,"authors":[{"id":"Robert B. Wexler","name":"Robert B. Wexler"}],"github":"https://github.com/wexlergroup/comp-prob-solv","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/wexlergroup/comp-prob-solv/blob/main/book/lecture-22-thermostatting.md","exports":[{"format":"md","filename":"lecture-22-thermostatting.md","url":"/lecture-22-thermosta-5e24677425969a8d8b1379ea73ca8e32.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Learning Objectives","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Nt6CK7cOFX"}],"identifier":"learning-objectives","label":"Learning Objectives","html_id":"learning-objectives","implicit":true,"key":"j5Pwt2r7If"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"By the end of this lecture, you should be able to:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"HhWyAfrHNI"}],"key":"mfB3DPOVVb"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Explain the concept of thermostatting in molecular dynamics simulations and its importance in maintaining constant temperature.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"GxEIx7IAwr"}],"key":"UjVqwuRG4w"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Describe how the Andersen thermostat works and its impact on the system’s dynamics.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"jfthioAU1W"}],"key":"p1drf8M7DD"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Implement the velocity Verlet algorithm combined with the Andersen thermostat in a 2D molecular dynamics simulation.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"gAmtQqNABD"}],"key":"mkjTqjnMfV"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Analyze the effects of thermostatting on energy conservation and temperature control in simulations.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"WFXzbZT6Tn"}],"key":"vC6SnGesZ9"}],"key":"n3M8RkZFpx"},{"type":"heading","depth":2,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Setting the ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"U53eeUNphD"},{"type":"emphasis","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Computational","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"OYfVWdXcfZ"}],"key":"LnvzPJYacm"},{"type":"text","value":" Thermostat","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"fGgvM1NiS4"}],"identifier":"setting-the-computational-thermostat","label":"Setting the Computational Thermostat","html_id":"setting-the-computational-thermostat","implicit":true,"key":"cRWNNtYj3G"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"In molecular dynamics simulations, we often want to simulate a system at a ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"pT2ZrLlPjS"},{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"constant temperature","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"Tac6YrDOKa"}],"key":"XeQumsaLUw"},{"type":"text","value":", corresponding to the canonical ensemble (NVT ensemble). However, when we numerically integrate Newton’s equations of motion, the total energy of the system is conserved, leading to a microcanonical ensemble (NVE ensemble). To model real-world systems where temperature is controlled, we need to introduce ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"kqCi86zb8T"},{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"thermostats","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"soLW3n9PRa"}],"key":"aD1WfNqALA"},{"type":"text","value":" that adjust the kinetic energy of the particles to maintain the desired temperature.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"GFUuwh5jKY"}],"key":"xAXLFK6bJm"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Thermostatting involves coupling the system to an external ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"BoUp4CfrWO"},{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"heat bath","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"nWeQD5pRBg"}],"key":"ZGf0AUMlZ2"},{"type":"text","value":", which can exchange energy with the system. This process allows the simulation to sample configurations according to the canonical distribution, enabling the study of temperature-dependent properties and phase behavior.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"mwfY7oZR4O"}],"key":"lIp1n5IyCv"},{"type":"heading","depth":2,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Andersen Thermostat","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"Wkgg7oyuLO"}],"identifier":"andersen-thermostat","label":"Andersen Thermostat","html_id":"andersen-thermostat","implicit":true,"key":"KFalM7haCJ"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"The Andersen thermostat is a stochastic method introduced by ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"FXImCO7MM6"},{"type":"cite","url":"https://doi.org/10.1063/1.439486","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Hans C. Andersen in 1980","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"raK0EsRl0E"}],"kind":"narrative","label":"Andersen_1980","identifier":"https://doi.org/10.1063/1.439486","enumerator":"1","key":"Tx8k7DAyrj"},{"type":"text","value":" to maintain a constant temperature in MD simulations. It simulates the effect of collisions with an imaginary heat bath by randomly reassigning particle velocities, thus mimicking interactions with a thermal reservoir.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"mnliUnGILD"}],"key":"iPslVxY8gU"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"The key idea is to occasionally interrupt the deterministic trajectory of particles by “collisions” with the heat bath:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"zbCxDpLN62"}],"key":"iep2BurwdS"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":37,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"At each time step, each particle has a probability ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"pJ3Jh8qojL"},{"type":"inlineMath","value":"\\nu \\Delta t","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ν</mi><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\nu \\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.06366em;\">ν</span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"IGVNW3rukt"},{"type":"text","value":" of colliding with the heat bath, where ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"y9pjtZwGLK"},{"type":"inlineMath","value":"\\nu","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ν</mi></mrow><annotation encoding=\"application/x-tex\">\\nu</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.06366em;\">ν</span></span></span></span>","key":"wVcQP7aWrH"},{"type":"text","value":" is the collision frequency.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"waR2izfxqJ"}],"key":"FT18dlE8mn"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"When a collision occurs, the particle’s velocity is reassigned from the Maxwell-Boltzmann distribution at the desired temperature ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"nQKX8BH5wk"},{"type":"inlineMath","value":"T","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span>","key":"unXgU12H5L"},{"type":"text","value":".","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"kbQK4o9Cjv"}],"key":"wh0KuPxDMv"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"Particles not colliding continue their motion according to Newton’s laws.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"y7OREv90HM"}],"key":"vCGmxcLCoT"}],"key":"kFDdzBZqpf"},{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"This approach maintains the correct canonical distribution of particle velocities and allows the system to equilibrate at the desired temperature.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"LIzBYPpTit"}],"key":"kztdrA486Y"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"MIUl9FSkV1"}],"key":"e0yX6FMjt4"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"The Andersen thermostat disrupts the conservation of total momentum because velocities are randomly reassigned without regard to the system’s overall momentum. This can affect properties dependent on momentum conservation, such as diffusion coefficients and flow behavior. If preserving momentum is critical for your simulation, consider using thermostats like the Nosé-Hoover thermostat, which conserves momentum while controlling temperature.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"ZCKKVJIsSM"}],"key":"ZjutSQ1gRb"}],"key":"N52CEKKHKO"},{"type":"heading","depth":2,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Velocity Verlet Algorithm","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"y6ckFgTExI"}],"identifier":"velocity-verlet-algorithm","label":"Velocity Verlet Algorithm","html_id":"velocity-verlet-algorithm","implicit":true,"key":"zVtbg6c1KH"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"The velocity Verlet algorithm is an integration scheme that updates both positions and velocities in a time-symmetric way, offering improved numerical stability and energy conservation compared to basic Verlet integration.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"fayTwVfopU"}],"key":"kvnXzQDadY"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Algorithm Steps","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"q7YbxP0aL3"}],"key":"Mn39kDqpwW"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":54,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"strong","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Position Update:","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"J8pXmoLyQG"}],"key":"gDbiaQBYDs"}],"key":"qnNy62DegJ"},{"type":"math","value":"\\mathbf{r}(t + \\Delta t) = \\mathbf{r}(t) + \\mathbf{v}(t)\\Delta t + \\frac{\\mathbf{F}(t)}{2m}\\Delta t^2","position":{"start":{"line":56,"column":1},"end":{"line":58,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"bold\">r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"bold\">r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo>+</mo><mfrac><mrow><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><mi mathvariant=\"normal\">Δ</mi><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbf{r}(t + \\Delta t) = \\mathbf{r}(t) + \\mathbf{v}(t)\\Delta t + \\frac{\\mathbf{F}(t)}{2m}\\Delta t^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\">Δ</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"1","key":"LbYRBIUlkc"}],"key":"m5DYk4TofD"},{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"strong","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"Compute Forces:","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"QoqCyP4QDy"}],"key":"Jbe6i4Xb9S"},{"type":"text","value":"\nCalculate ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"zXm5GJEgZH"},{"type":"inlineMath","value":"\\mathbf{F}(t + \\Delta t)","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf{F}(t + \\Delta t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"qX9SuQwTFh"},{"type":"text","value":" based on the updated positions ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"JmUgODNbf7"},{"type":"inlineMath","value":"\\mathbf{r}(t + \\Delta t)","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf{r}(t + \\Delta t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"SjqP9uXuw2"},{"type":"text","value":".","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"up7feWApwR"}],"key":"wnoKf84kpZ"}],"key":"VyRnAI0S7a"},{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"strong","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"Velocity Update:","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Agu89shtuR"}],"key":"vGrC1aPblI"}],"key":"XxTweL6shy"},{"type":"math","value":"\\mathbf{v}(t + \\Delta t) = \\mathbf{v}(t) + \\frac{\\mathbf{F}(t) + \\mathbf{F}(t + \\Delta t)}{2m}\\Delta t","position":{"start":{"line":63,"column":1},"end":{"line":65,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mfrac><mrow><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{v}(t + \\Delta t) = \\mathbf{v}(t) + \\frac{\\mathbf{F}(t) + \\mathbf{F}(t + \\Delta t)}{2m}\\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span></span>","enumerator":"2","key":"A4G98kWaQl"}],"key":"JW1DdPYw2s"}],"key":"P7uDlfCgTv"}],"class":"tip","key":"kBlAeZXgae"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"This method ensures that the positions and velocities are updated consistently, providing accurate trajectories for the particles.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"FDBwWBXaXf"}],"key":"eRuhmBncfQ"},{"type":"heading","depth":2,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"Velocity Verlet with Andersen Thermostat","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"QYmQCdTMaZ"}],"identifier":"velocity-verlet-with-andersen-thermostat","label":"Velocity Verlet with Andersen Thermostat","html_id":"velocity-verlet-with-andersen-thermostat","implicit":true,"key":"V8EGV5sWke"},{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"When combining the velocity Verlet algorithm with the Andersen thermostat, the velocity update step is adjusted to include stochastic collisions.","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"IuiG4RAhoh"}],"key":"BGQefgwPTc"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Modified Velocity Update","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"M8oGgzgYwo"}],"key":"ykyB4LYa7B"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"strong","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"After the standard velocity update,","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"k2nlbgW1By"}],"key":"I2GINH6Mdg"},{"type":"text","value":" apply the Andersen thermostat:","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"XfVHfW7kGc"}],"key":"xPkW9BQSEB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":79,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"For each particle, generate a random number ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"VRNvOr2yau"},{"type":"inlineMath","value":"r","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>","key":"rlmJ50D6EL"},{"type":"text","value":" between 0 and 1.","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"z2md3RkxPc"}],"key":"cjJyUd11S9"},{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"If ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"KbsdA5vIHc"},{"type":"inlineMath","value":"r < \\nu \\Delta t","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo>&lt;</mo><mi>ν</mi><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">r &lt; \\nu \\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.06366em;\">ν</span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"hbQJzlJyWq"},{"type":"text","value":", reassign the particle’s velocity ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"oQkZOAI1x4"},{"type":"inlineMath","value":"\\mathbf{v}(t + \\Delta t)","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf{v}(t + \\Delta t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"CeXegBX9Te"},{"type":"text","value":" from the Maxwell-Boltzmann distribution.","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"Tg6WQEXwc5"}],"key":"znA8W2WV7w"}],"key":"X03G8Ox8pi"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"The modified velocity update step becomes:","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"ACR92Cub3n"}],"key":"WPHccOnBRH"},{"type":"math","value":"\\mathbf{v}(t + \\Delta t) = \\mathbf{v}(t) + \\frac{\\mathbf{F}(t) + \\mathbf{F}(t + \\Delta t)}{2m}\\Delta t + \\mathbf{R}(t)","position":{"start":{"line":84,"column":1},"end":{"line":86,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"bold\">v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mfrac><mrow><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi mathvariant=\"bold\">F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><mi mathvariant=\"normal\">Δ</mi><mi>t</mi><mo>+</mo><mi mathvariant=\"bold\">R</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf{v}(t + \\Delta t) = \\mathbf{v}(t) + \\frac{\\mathbf{F}(t) + \\mathbf{F}(t + \\Delta t)}{2m}\\Delta t + \\mathbf{R}(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathbf\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"UvB3qYIMUJ"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"qAnegBLhJ5"},{"type":"inlineMath","value":"\\mathbf{R}(t)","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">R</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbf{R}(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathbf\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"ExnUA2t1Ju"},{"type":"text","value":" is a random vector that is non-zero only if a collision occurs.","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"CJzOGINFEA"}],"key":"Nox3HZxmWx"}],"class":"tip","key":"m0c6rbPJ0a"},{"type":"heading","depth":3,"position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Drawing Random Velocities from a Maxwell-Boltzmann Velocity Distribution","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"QL3mfFm2LB"}],"identifier":"drawing-random-velocities-from-a-maxwell-boltzmann-velocity-distribution","label":"Drawing Random Velocities from a Maxwell-Boltzmann Velocity Distribution","html_id":"drawing-random-velocities-from-a-maxwell-boltzmann-velocity-distribution","implicit":true,"key":"fGXLKG516M"},{"type":"paragraph","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"To draw random velocities from a Maxwell-Boltzmann velocity distribution at the desired temperature, we can use ","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"GREyds1r14"},{"type":"inlineCode","value":"numpy.random.normal","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"txcAemGDcg"},{"type":"text","value":" to generate random numbers from a normal distribution and then scale them to have the desired temperature. The Maxwell-Boltzmann velocity distribution for a single dimension is given by","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"jJKC5cf3dw"}],"key":"KHWxZWWd4T"},{"type":"math","value":"f_v(v_x) = \\sqrt{\\frac{m}{2\\pi k_\\text{B}T}}\\exp\\left(-\\frac{mv_x^2}{2k_\\text{B}T}\\right)","position":{"start":{"line":95,"column":1},"end":{"line":97,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>f</mi><mi>v</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><msqrt><mfrac><mi>m</mi><mrow><mn>2</mn><mi>π</mi><msub><mi>k</mi><mtext>B</mtext></msub><mi>T</mi></mrow></mfrac></msqrt><mi>exp</mi><mo>⁡</mo><mrow><mo fence=\"true\">(</mo><mo>−</mo><mfrac><mrow><mi>m</mi><msubsup><mi>v</mi><mi>x</mi><mn>2</mn></msubsup></mrow><mrow><mn>2</mn><msub><mi>k</mi><mtext>B</mtext></msub><mi>T</mi></mrow></mfrac><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">f_v(v_x) = \\sqrt{\\frac{m}{2\\pi k_\\text{B}T}}\\exp\\left(-\\frac{mv_x^2}{2k_\\text{B}T}\\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4615em;vertical-align:-0.9703em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4697em;\"><span class=\"svg-align\" style=\"top:-4.4em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-3.4297em;\"><span class=\"pstrut\" style=\"height:4.4em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:2.48em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl0 -0c4,-6.7,10,-10,18,-10 H400000\nv40H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M1001 80\nh400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9703em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">exp</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4911em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span></span></span></span></span>","enumerator":"4","key":"uVrfsXA4L1"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"MnaCpsqRKE"},{"type":"inlineMath","value":"m","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"DfkxuFZLMf"},{"type":"text","value":" is the mass of the particle, ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"yzsFfO2TKk"},{"type":"inlineMath","value":"k_\\text{B}","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mtext>B</mtext></msub></mrow><annotation encoding=\"application/x-tex\">k_\\text{B}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"K45T3Zyg4t"},{"type":"text","value":" is the Boltzmann constant, and ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Q1VXF0HTDW"},{"type":"inlineMath","value":"T","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span>","key":"s2ZX2a9Olh"},{"type":"text","value":" is the temperature. The random velocities can be drawn from this distribution by generating random numbers from a normal distribution with mean 0 and standard deviation ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"EiaAXIiRNW"},{"type":"inlineMath","value":"\\sqrt{k_\\text{B}T/m}","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mrow><msub><mi>k</mi><mtext>B</mtext></msub><mi>T</mi><mi mathvariant=\"normal\">/</mi><mi>m</mi></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{k_\\text{B}T/m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.305em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span></span>","key":"OqJaXRWIx2"},{"type":"text","value":".","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"VbCZAWyPbV"}],"key":"qhFOgTAujQ"},{"type":"heading","depth":2,"position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"Example: Andersen Thermostat in 2D","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"J4LAmCaq0e"}],"identifier":"example-andersen-thermostat-in-2d","label":"Example: Andersen Thermostat in 2D","html_id":"example-andersen-thermostat-in-2d","implicit":true,"key":"tcFXcSrhFF"},{"type":"paragraph","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"Let’s implement the Andersen thermostat in 2D for a system of particles in a box. We will use the Lennard-Jones potential to calculate the forces between the particles.","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"kLOB0sqwVO"}],"key":"FYyXw6MfiH"},{"type":"heading","depth":3,"position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"Initialization","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"xX9yr5XKUS"}],"identifier":"initialization","label":"Initialization","html_id":"initialization","implicit":true,"key":"jnaCW59BCi"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"First, we will define a function to initialize the positions and velocities of the particles.","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"teIozhdsbA"}],"key":"tb5LQ3KvFZ"}],"key":"CM6hfmLg9b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nnp.random.seed(5)\n\ndef initialize_particles(n_particles, box_size, temperature):\n    # Place the particles on a square lattice\n    n_side = int(np.ceil(np.sqrt(n_particles)))\n    positions = np.zeros((n_particles, 2))\n    for i in range(n_particles):\n        x = i % n_side + 0.5\n        y = i // n_side + 0.5\n        positions[i] = [x, y]\n    positions = positions * box_size / n_side\n\n    # Give the particles random velocities\n    velocities = np.random.uniform(-0.5, 0.5, (n_particles, 2))\n\n    # Calculate the center of mass velocity\n    v_com = np.sum(velocities, axis=0) / n_particles\n\n    # Subtract the center of mass velocity from the velocities\n    velocities -= v_com\n\n    # Scale the velocities to have the desired temperature\n    v2 = np.sum(velocities**2)\n    scale_factor = np.sqrt(2 * n_particles * temperature / v2)\n    velocities *= scale_factor\n\n    return positions, velocities","key":"XJM3q5dRqN"},{"type":"output","id":"dJQ6VlILxAFOKp1K6Vas1","data":[],"key":"WuI3XfTCy8"}],"key":"q5LLe14sXT"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Plotting the Initial Particle Positions and Velocities","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"OpbGd5J0ru"}],"identifier":"plotting-the-initial-particle-positions-and-velocities","label":"Plotting the Initial Particle Positions and Velocities","html_id":"plotting-the-initial-particle-positions-and-velocities","implicit":true,"key":"lVGC4ecmDO"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"Let’s plot the initial positions and velocities of the particles.","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"tUTnTUsIEk"}],"key":"RaTxVIPcbU"}],"key":"MUmxYnIpYp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nfrom matplotlib.patches import Circle\n\ndef plot_positions(positions, ax, title):\n    for i in range(len(positions)):\n        ax.add_patch(Circle(positions[i], 0.5, fc='cyan', ec='black'))\n    ax.set_title(title)\n    ax.set_xlabel('x')\n    ax.set_ylabel('y')\n    ax.set_xlim(0, box_size)\n    ax.set_ylim(0, box_size)\n    ax.set_aspect('equal')\n    return ax\n\ndef plot_vectors(positions, vectors, ax, title):\n    for i in range(len(positions)):\n        ax.arrow(positions[i, 0], positions[i, 1], vectors[i, 0], vectors[i, 1], head_width=0.2, head_length=0.2, fc='cyan', ec='black')\n    ax.set_title(title)\n    ax.set_xlabel('x')\n    ax.set_ylabel('y')\n    ax.set_xlim(0, box_size)\n    ax.set_ylim(0, box_size)\n    ax.set_aspect('equal')\n    return ax\n\nn_particles = 16\nbox_size = 10\ntemperature = 0.1\n\npositions, velocities = initialize_particles(n_particles, box_size, temperature)\n\nfig, axs = plt.subplots(1, 2, figsize=(12, 6))\n\nplot_positions(positions, axs[0], 'Initial Particle Positions')\nplot_vectors(positions, velocities, axs[1], 'Initial Particle Velocities')\n\nplt.show()","key":"q4tdI907oS"},{"type":"output","id":"3BMhhR3lfg3GCbXDIsrml","data":[],"key":"CLBMI92fGl"}],"key":"RYfjbilrLg"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Calculating the Forces","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"UFSoq7ioQn"}],"identifier":"calculating-the-forces","label":"Calculating the Forces","html_id":"calculating-the-forces","implicit":true,"key":"vSpEUHOjSF"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"Next, we will define functions to calculate the Lennard-Jones potential and forces between the particles.","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"rYKbtO7qBg"}],"key":"BF0DFomIX2"}],"key":"pUiDup5OVz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Lennard-Jones potential\ndef U(r, epsilon=1.0, sigma=1.0):\n    return 4 * epsilon * ((sigma / r)**12 - (sigma / r)**6)\n\n# Lennard-Jones force\ndef F(r, epsilon=1.0, sigma=1.0):\n    return 24 * epsilon * (2 * (sigma / r)**12 - (sigma / r)**6) / r\n\n# Calculate the forces between the particles\ndef calculate_forces(positions, box_size, epsilon=1.0, sigma=1.0):\n    n_particles = len(positions)\n    forces = np.zeros((n_particles, 2))\n    potential_energy = 0\n\n    for i in range(n_particles):\n        for j in range(i + 1, n_particles):\n            r = np.linalg.norm(positions[i] - positions[j])\n            potential_energy += U(r, epsilon, sigma)\n            f = F(r, epsilon, sigma) * (positions[i] - positions[j]) / r\n            forces[i] += f\n            forces[j] -= f\n\n    return forces, potential_energy","key":"Yoc3B8zodK"},{"type":"output","id":"iv4CMWdRqHK_hHyWDw6wn","data":[],"key":"i8RSRgTDSp"}],"key":"UUsjjW4RTG"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"Plotting the Initial Forces","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"ySioMwYHdU"}],"identifier":"plotting-the-initial-forces","label":"Plotting the Initial Forces","html_id":"plotting-the-initial-forces","implicit":true,"key":"S3qkpV4hM3"},{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Let’s calculate the forces between the particles and plot the initial forces.","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"SiEkM31ebI"}],"key":"m6EbLkfYtJ"}],"key":"PvAk0WKRnU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"forces, _ = calculate_forces(positions, box_size)\n\nfig, ax = plt.subplots(figsize=(6, 6))\n\nplot_vectors(positions, forces, ax, 'Initial Forces')\n\nplt.show()","key":"uKka71LraS"},{"type":"output","id":"iXwDMuZ6KgMP6vphP2EHj","data":[],"key":"r16TinvdaU"}],"key":"QqYUoGQp52"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"Velocity Verlet Algorithm with Andersen Thermostat","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"yY3CpMEruw"}],"identifier":"velocity-verlet-algorithm-with-andersen-thermostat","label":"Velocity Verlet Algorithm with Andersen Thermostat","html_id":"velocity-verlet-algorithm-with-andersen-thermostat","implicit":true,"key":"XZGxmp8leP"},{"type":"paragraph","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"Now, we will implement the velocity Verlet algorithm with the Andersen thermostat.","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"cWNm0jth30"}],"key":"feW0hyTJX5"}],"key":"RTa78QiVeQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def velocity_verlet(positions, velocities, forces, mass, box_size, temperature, dt, coupling_constant, epsilon=1.0, sigma=1.0, k_B=1.0):\n    # Update positions based on current velocities and forces\n    positions += velocities * dt + forces / (2 * mass) * dt**2\n\n    # Apply periodic boundary conditions or walls (if applicable)\n    # Here, we use walls by reflecting particles that cross the boundaries\n    for i in range(len(positions)):\n        # Check x-coordinate boundaries\n        if positions[i, 0] < sigma / 2 or positions[i, 0] > box_size - sigma / 2:\n            # Reflect position\n            positions[i, 0] = np.clip(positions[i, 0], sigma / 2, box_size - sigma / 2)\n            # Reverse velocity component\n            velocities[i, 0] *= -1\n        # Check y-coordinate boundaries\n        if positions[i, 1] < sigma / 2 or positions[i, 1] > box_size - sigma / 2:\n            positions[i, 1] = np.clip(positions[i, 1], sigma / 2, box_size - sigma / 2)\n            velocities[i, 1] *= -1\n\n    # Compute new forces based on updated positions\n    forces, potential_energy = calculate_forces(positions, box_size, epsilon, sigma)\n\n    # Update velocities with average of old and new forces\n    velocities += forces / mass * dt\n\n    # Apply the Andersen thermostat\n    for i in range(len(velocities)):\n        if np.random.rand() < coupling_constant:\n            # Reassign velocity from Maxwell-Boltzmann distribution\n            velocities[i] = np.random.normal(0, np.sqrt(k_B * temperature / mass), 2)\n\n    # Calculate kinetic energy for diagnostics\n    kinetic_energy = 0.5 * mass * np.sum(velocities**2)\n\n    return positions, velocities, forces, potential_energy, kinetic_energy","key":"BpjYnOBZ03"},{"type":"output","id":"d3b_dRSrardtO-hJbLh8z","data":[],"key":"CmrEznpY9R"}],"key":"CiS3zsA8Sk"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"Running the Simulation","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"qMcFgUYOrc"}],"identifier":"running-the-simulation","label":"Running the Simulation","html_id":"running-the-simulation","implicit":true,"key":"UevifjNNPs"},{"type":"paragraph","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"children":[{"type":"text","value":"Finally, we will run the simulation and plot the final particle positions and velocities.","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"Ut1jXt2xmi"}],"key":"UL4dmjKFte"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Parameter Selection","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"O5rHZZJJdM"}],"key":"saSCtTlExT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":276,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"strong","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"Coupling Constant (","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"ETE1aV53bc"},{"type":"inlineMath","value":"\\nu \\Delta t","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ν</mi><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\nu \\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.06366em;\">ν</span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"wgLPYKC2Vo"},{"type":"text","value":"):","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"OW7Xaxjz6v"}],"key":"BZw1htTtPW"},{"type":"text","value":" Determines the frequency of collisions with the heat bath. A higher value leads to more frequent temperature adjustments but can overly randomize particle motions.","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"sgKO1gU8XD"}],"key":"S9I4Ps1CFZ"},{"type":"listItem","spread":true,"position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"strong","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"text","value":"Time Step (","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"mktlFYAPg8"},{"type":"inlineMath","value":"\\Delta t","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"BSBAzZ7utt"},{"type":"text","value":"):","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"oi2gcZMi0i"}],"key":"WF4f2MtTml"},{"type":"text","value":" Must be small enough to accurately capture particle dynamics. Typically, ","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"N8sfsCK6Dr"},{"type":"inlineMath","value":"\\Delta t","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Δ</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\Delta t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"CeT6mEzzng"},{"type":"text","value":" is chosen so that the maximum displacement per step is much smaller than the interaction range ","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"US076rdvl8"},{"type":"inlineMath","value":"\\sigma","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span></span>","key":"cuYIA7Yvji"},{"type":"text","value":".","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"ywdTAxwgQh"}],"key":"AmfLTCHaW1"},{"type":"listItem","spread":true,"position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"strong","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"Number of Particles (","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"Xgs8gKo9Np"},{"type":"inlineMath","value":"N","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>","key":"jqq1Icjh1G"},{"type":"text","value":"):","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"qtOFFONyQp"}],"key":"XlpUEkPK17"},{"type":"text","value":" Affects statistical accuracy and computational cost. Larger systems provide better sampling of properties but require more computational resources.","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"KOAYmkPkFJ"}],"key":"YCHhvc9sYZ"}],"key":"PSnt0ec6DN"}],"class":"tip","key":"R46abPugXJ"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Units and Constants","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"LkPlsit3F9"}],"key":"BFFOJCsbeI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":284,"column":1},"end":{"line":288,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"strong","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"Mass (","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"cw2xYQ14UK"},{"type":"inlineMath","value":"m","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"SE82joJbvi"},{"type":"text","value":")","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"hZUDCL9yuD"}],"key":"NqT2kNfMDZ"},{"type":"text","value":": Set to 1 (arbitrary units) for simplicity.","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"ysrymQ4wQq"}],"key":"G9OJZZ1Gjf"},{"type":"listItem","spread":true,"position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"strong","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"text","value":"Distance (","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"FWmry7I4uX"},{"type":"inlineMath","value":"\\sigma","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span></span>","key":"QgPnzqZmiu"},{"type":"text","value":")","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"bDE1pnCTn6"}],"key":"lW46yqpOiQ"},{"type":"text","value":": The characteristic length scale in the Lennard-Jones potential, set to 1.","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"boJ5VElWjt"}],"key":"HOS1eim4qe"},{"type":"listItem","spread":true,"position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"strong","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"Energy (","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"iezvbGuntr"},{"type":"inlineMath","value":"\\epsilon","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding=\"application/x-tex\">\\epsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ϵ</span></span></span></span>","key":"JBBHT60zXc"},{"type":"text","value":")","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"oOmdmliqEM"}],"key":"z4y9u7bx00"},{"type":"text","value":": The depth of the potential well in the Lennard-Jones potential, set to 1.","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"cy60HZccdD"}],"key":"mxloTrQaEw"},{"type":"listItem","spread":true,"position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"strong","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Boltzmann Constant (","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"aGfQMOD3pa"},{"type":"inlineMath","value":"k_B","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">k_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"BC5tUiWlVj"},{"type":"text","value":")","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"AFgtt1bIoQ"}],"key":"EORjB4ZSCI"},{"type":"text","value":": Set to 1 for reduced units.","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"ZUZe38FLHE"}],"key":"gi7JRXGn6p"},{"type":"listItem","spread":true,"position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"children":[{"type":"strong","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"children":[{"type":"text","value":"Temperature (","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"p9eSCZjJWB"},{"type":"inlineMath","value":"T","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span>","key":"DTNgMLhs7h"},{"type":"text","value":")","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"YxFMxibZxq"}],"key":"Q5sGmbfbDT"},{"type":"text","value":": Expressed in units where ","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"Cy0SbXPbP0"},{"type":"inlineMath","value":"k_B = 1","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>B</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">k_B = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"GysIUphs0t"},{"type":"text","value":".","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"SGf2UroGjX"}],"key":"XlUlHzbVPH"}],"key":"G2hAOBWtLA"}],"class":"tip","key":"QbydoJP6mu"}],"key":"rVkTO5mg0V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Simulation parameters\nmass = 1\ndt = 0.01\nn_steps = 30000\ncoupling_constant = 0.1\n\n# Initialize the particles\npositions, velocities = initialize_particles(n_particles, box_size, temperature)\n\n# Calculate the forces\nforces, _ = calculate_forces(positions, box_size)\n\n# Arrays to store the history of the simulation\npositions_history = np.zeros((n_steps, n_particles, 2))\npotential_energy_history = np.zeros(n_steps)\nkinetic_energy_history = np.zeros(n_steps)\n\n# Run the simulation\nfor i in range(n_steps):\n    positions, velocities, forces, potential_energy, kinetic_energy = velocity_verlet(positions, velocities, forces, mass, box_size, temperature, dt, coupling_constant)\n    positions_history[i] = positions\n    potential_energy_history[i] = potential_energy\n    kinetic_energy_history[i] = kinetic_energy","key":"Kvf8rA5PFY"},{"type":"output","id":"GV9Yxd9NP5etiGjg7so9j","data":[],"key":"r5pRC14miz"}],"key":"wMyxSoI7En"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"children":[{"type":"text","value":"Plotting the Final Particle Positions and Velocities","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"elrRVAMWJq"}],"identifier":"plotting-the-final-particle-positions-and-velocities","label":"Plotting the Final Particle Positions and Velocities","html_id":"plotting-the-final-particle-positions-and-velocities","implicit":true,"key":"NEIAQFfLHu"}],"key":"cQiWfBa3Wi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs = plt.subplots(1, 2, figsize=(12, 6))\n\nplot_positions(positions, axs[0], 'Final Particle Positions')\nplot_vectors(positions, velocities, axs[1], 'Final Particle Velocities')\n\nplt.show()","visibility":"hide","key":"VwM5HmMWa2"},{"type":"output","id":"WGYAan0Kn4At96bhWu53b","data":[],"visibility":"show","key":"oYc4qO5Pjp"}],"data":{"tags":[]},"visibility":"show","key":"BqGdBeDH0H"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"text","value":"Plotting and Analyzing Energy Conservation and Temperature Control","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"VHilL85vwS"}],"identifier":"plotting-and-analyzing-energy-conservation-and-temperature-control","label":"Plotting and Analyzing Energy Conservation and Temperature Control","html_id":"plotting-and-analyzing-energy-conservation-and-temperature-control","implicit":true,"key":"ALk9ODiH96"}],"key":"QPiiPYQrr3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"total_energy_history = potential_energy_history + kinetic_energy_history\ntemperature_history = 2 * kinetic_energy_history / (2 * n_particles - 2)\n\nfig, axs = plt.subplot_mosaic([[0, 1], [2, 3]], figsize=(12, 12))\n\naxs[0].plot(np.arange(n_steps - 2000, n_steps), potential_energy_history[-2000:], 'tab:gray', label='Potential Energy', alpha=0.5)\naxs[0].set_title('Potential Energy')\naxs[0].set_xlabel('Time Step')\naxs[0].set_ylabel('Energy')\navg_potential_energy = np.mean(potential_energy_history[-2000:])\naxs[0].axhline(y=avg_potential_energy, color='r', linestyle='--', label='Average Potential Energy')\naxs[0].text(\n    0.5, 0.9, \n    f'Average Potential Energy: {avg_potential_energy:.2f}', \n    ha='center', \n    va='center', \n    transform=axs[0].transAxes,\n    color='red',\n    bbox=dict(facecolor='white', alpha=0.5, edgecolor='none')\n)\n\naxs[1].plot(np.arange(n_steps - 2000, n_steps), kinetic_energy_history[-2000:], 'tab:gray', label='Kinetic Energy', alpha=0.5)\naxs[1].set_title('Kinetic Energy')\naxs[1].set_xlabel('Time Step')\naxs[1].set_ylabel('Energy')\navg_kinetic_energy = np.mean(kinetic_energy_history[-2000:])\naxs[1].axhline(y=avg_kinetic_energy, color='r', linestyle='--', label='Average Kinetic Energy')\naxs[1].text(\n    0.5, 0.9, \n    f'Average Kinetic Energy: {avg_kinetic_energy:.2f}', \n    ha='center', \n    va='center', \n    transform=axs[1].transAxes,\n    color='red',\n    bbox=dict(facecolor='white', alpha=0.5, edgecolor='none')\n)\n\naxs[2].plot(np.arange(n_steps - 2000, n_steps), total_energy_history[-2000:], 'tab:gray', label='Total Energy', alpha=0.5)\naxs[2].set_title('Total Energy')\naxs[2].set_xlabel('Time Step')\naxs[2].set_ylabel('Energy')\navg_total_energy = np.mean(total_energy_history[-2000:])\naxs[2].axhline(y=avg_total_energy, color='r', linestyle='--', label='Average Total Energy')\naxs[2].text(\n    0.5, 0.9, \n    f'Average Total Energy: {avg_total_energy:.2f}', \n    ha='center', \n    va='center', \n    transform=axs[2].transAxes,\n    color='red',\n    bbox=dict(facecolor='white', alpha=0.5, edgecolor='none')\n)\n\naxs[3].plot(np.arange(n_steps - 2000, n_steps), temperature_history[-2000:], 'tab:gray', label='Temperature', alpha=0.5)\naxs[3].set_title('Temperature')\naxs[3].set_xlabel('Time Step')\naxs[3].set_ylabel('Temperature')\navg_temperature = np.mean(temperature_history[-2000:])\naxs[3].axhline(y=avg_temperature, color='tab:red', linestyle='--', label='Average Temperature')\naxs[3].text(\n    0.5, 0.9, \n    f'Average Temperature: {avg_temperature:.2f}', \n    ha='center', \n    va='center', \n    transform=axs[3].transAxes,\n    color='red',\n    bbox=dict(facecolor='white', alpha=0.5, edgecolor='none')\n)\naxs[3].axhline(y=temperature, color='tab:blue', linestyle='--', label='Desired Temperature')\naxs[3].text(\n    0.5, 0.8, \n    f'Desired Temperature: {temperature}', \n    ha='center', \n    va='center', \n    transform=axs[3].transAxes,\n    color='tab:blue',\n    bbox=dict(facecolor='white', alpha=0.5, edgecolor='none')\n)\n\nplt.show()","visibility":"hide","key":"noNpvucALP"},{"type":"output","id":"cstZGiiDxLFBARhca6Xur","data":[],"visibility":"show","key":"xaeWYYeHD5"}],"data":{"tags":[]},"visibility":"show","key":"LfVzyQjEvo"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":417,"column":1},"end":{"line":417,"column":1}},"children":[{"type":"text","value":"The plots show that while the kinetic and potential energies fluctuate due to stochastic collisions, the total energy remains relatively stable. This indicates that the Andersen thermostat maintains the system’s temperature without causing significant energy drift.","position":{"start":{"line":417,"column":1},"end":{"line":417,"column":1}},"key":"y3Qc9zbORM"}],"key":"FBYmQQbATK"},{"type":"paragraph","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"children":[{"type":"text","value":"The temperature plot demonstrates that the system’s temperature converges to the desired value (","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"UYA1Irt1GQ"},{"type":"inlineMath","value":"T = 0.1","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding=\"application/x-tex\">T = 0.1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.1</span></span></span></span>","key":"KF7cQUKAiV"},{"type":"text","value":") over time. The fluctuations around the mean temperature are expected due to the finite size of the system and stochastic nature of the thermostat.","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"I7HEVB8l9P"}],"key":"y79CIxzvm9"},{"type":"heading","depth":3,"position":{"start":{"line":421,"column":1},"end":{"line":421,"column":1}},"children":[{"type":"text","value":"Plotting and Analyzing Particle Dynamics","position":{"start":{"line":421,"column":1},"end":{"line":421,"column":1}},"key":"HUacMBxw5j"}],"identifier":"plotting-and-analyzing-particle-dynamics","label":"Plotting and Analyzing Particle Dynamics","html_id":"plotting-and-analyzing-particle-dynamics","implicit":true,"key":"aZIH4sIJCV"}],"key":"NfagpZTD3p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs = plt.subplots(3, 3, figsize=(18, 18))\n\nfor i, ax in enumerate(axs.flat):\n    plot_positions(positions_history[i * n_steps // 9], ax, f'Time Step {i * n_steps // 9}')\n\nplt.show()","visibility":"hide","key":"KYjaXJHXdg"},{"type":"output","id":"QeRUXNYeD3t4wbtV8hZbu","data":[],"visibility":"show","key":"nOOucFrJEV"}],"data":{"tags":[]},"visibility":"show","key":"wkLQ2pFJvv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"The snapshots illustrate how particles move and interact under the influence of the Lennard-Jones potential and the Andersen thermostat. Over time, the particles begin to form clusters because their initial separation distances are ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"Ju9jMCvsFw"},{"type":"strong","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"greater than the equilibrium distance","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"DlJs1HXSbi"}],"key":"yNRuGsww4Q"},{"type":"text","value":" of the Lennard-Jones potential, and the ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"sU3P5QOnkU"},{"type":"link","url":"https://en.wikipedia.org/wiki/Lennard-Jones_potential#Thermophysical_properties_of_the_Lennard-Jones_substance","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"temperature is relatively low","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"cdrdKMFTqg"}],"urlSource":"https://en.wikipedia.org/wiki/Lennard-Jones_potential#Thermophysical_properties_of_the_Lennard-Jones_substance","data":{"page":"Lennard-Jones_potential#Thermophysical_properties_of_the_Lennard-Jones_substance","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"oUWn91YhNW"},{"type":"text","value":". As the simulation progresses, the ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"fWLeX5ZAa4"},{"type":"strong","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"attractive forces dominate","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"gUpq9t1fTm"}],"key":"kbrJn3aND4"},{"type":"text","value":", drawing the particles closer together to minimize the system’s potential energy.","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"DRhPS4QVob"}],"key":"OtMh7wOtVQ"},{"type":"paragraph","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"text","value":"If the simulation were run for a longer duration, the particles would eventually coalesce into a single cluster. ","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"kJ2bJCFXlX"},{"type":"strong","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"text","value":"This aggregation is driven by the particles seeking the potential energy minimum at the equilibrium separation distance.","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"oroBXbhfNL"}],"key":"YAcrvB9Gvr"},{"type":"text","value":" Notice how the particles arrange themselves in a ","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"lVnKisOHEo"},{"type":"strong","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"text","value":"hexagonally close-packed structure","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"VYykYDqV8W"}],"key":"hrdf6FwxNl"},{"type":"text","value":", which is a common configuration in 2D systems with spherically symmetric interactions like the Lennard-Jones potential.","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"PX26ZKN8GL"}],"key":"K8gdvjzHqS"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Limitations of the Andersen Thermostat","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"jkDszHwpx3"}],"key":"tXDyoKN6Xk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":441,"column":1},"end":{"line":442,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"strong","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"text","value":"Momentum Conservation:","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"DXqJOvaL25"}],"key":"bppXEnHdrM"},{"type":"text","value":" As previously noted, the Andersen thermostat does not conserve total momentum, which can impact transport properties.","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"B6gVRnozur"}],"key":"egkCWL7Akt"},{"type":"listItem","spread":true,"position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"children":[{"type":"strong","position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"children":[{"type":"text","value":"Dynamics Alteration:","position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"key":"FprtWAkTdq"}],"key":"UhzHjzgO4A"},{"type":"text","value":" Frequent velocity reassignment can disrupt the natural dynamics of the system, potentially affecting time-correlation functions.","position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"key":"LTF3eK3Srg"}],"key":"jOf1MHKzRf"}],"key":"Prj5EX1V1b"}],"class":"warning","key":"lGZxG81EQT"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Alternatives","position":{"start":{"line":445,"column":1},"end":{"line":445,"column":1}},"key":"Nyw3yL5BLl"}],"key":"rt1Vxfjfbg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":448,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"children":[{"type":"strong","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"children":[{"type":"text","value":"Nosé-Hoover Thermostat:","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"weMIRz7Qlf"}],"key":"INPv6IFm77"},{"type":"text","value":" A deterministic thermostat that maintains momentum conservation and better preserves dynamic properties.","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"StBQYB4p01"}],"key":"O7kRAA1laK"},{"type":"listItem","spread":true,"position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"strong","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"text","value":"Langevin Dynamics:","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"key":"Au9rlUTVxk"}],"key":"R2vsbMDULK"},{"type":"text","value":" Incorporates friction and random forces, suitable for modeling systems in contact with a heat bath while maintaining some dynamical features.","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"key":"KUhVS2wKdd"}],"key":"AyGbF7vFFC"}],"key":"nSrmJcnIr2"}],"class":"tip","key":"vA1HbySnAo"},{"type":"heading","depth":2,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"u56OqmUBaK"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"PbLXLuoZxa"},{"type":"paragraph","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"In this lecture, we explored the concept of ","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"o44vo7CACP"},{"type":"strong","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"thermostatting","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"gESndghMjl"}],"key":"dTtvsAVJKR"},{"type":"text","value":" in molecular dynamics simulations, focusing on the ","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"WvWuHluqtN"},{"type":"strong","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"Andersen thermostat","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"LlsBZ4hJIg"}],"key":"vrHTxPTyup"},{"type":"text","value":". We discussed how the Andersen thermostat maintains constant temperature by randomly reassigning particle velocities, simulating collisions with a heat bath.","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"IDByuVzL6d"}],"key":"j8LSM2WoPv"},{"type":"paragraph","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"We implemented the Andersen thermostat in combination with the ","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"lyv5MZcnyu"},{"type":"strong","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"velocity Verlet algorithm","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"Yrtb6SCm1D"}],"key":"YxBIZ5FRlF"},{"type":"text","value":" for a 2D system of particles interacting via the Lennard-Jones potential. Through the simulation, we observed how the thermostat controls the temperature and affects energy conservation.","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"kQxItGKs3Z"}],"key":"v7dkLgZZWl"},{"type":"paragraph","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"children":[{"type":"text","value":"The results demonstrated effective temperature regulation and provided insights into the behavior of particles under thermostatting. We also discussed the limitations of the Andersen thermostat and briefly introduced alternative methods.","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"key":"cWBQ78xqlq"}],"key":"hToy8wCzF9"}],"key":"gWQv3zLgdw"}],"key":"ChZoZL1Rzk"},"references":{"cite":{"order":["Andersen_1980"],"data":{"Andersen_1980":{"label":"Andersen_1980","enumerator":"1","doi":"10.1063/1.439486","html":"Andersen, H. C. (1980). Molecular dynamics simulations at constant pressure and/or temperature. <i>The Journal of Chemical Physics</i>, <i>72</i>(4), 2384–2393. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1063/1.439486\">10.1063/1.439486</a>","url":"https://doi.org/10.1063/1.439486"}}}}}